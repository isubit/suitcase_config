<?php
/**
 * @file
 * Code for the suitcase_config feature.
 */

include_once 'suitcase_config.features.inc';

/**
 * Implements hook_update_projects_alter().
 */
function suitcase_config_update_projects_alter(&$projects) {
  // Hide a site-specific module from the list.
  unset($projects['suitcase_config']);
}

// Add the tb_megamenu block to the branding region for the theme suitcase
function suitcase_config_pre_features_enable_feature($component) {
  watchdog('suitcase_config', 'hook_pre_features_enable_feature', $variables = array($component), $severity = WATCHDOG_NOTICE, $link = NULL);
  //  Removing unwanted blocks
  db_update('block')->fields(array('region' => '-1','status' => '0',))->condition('delta', 'help')->condition('theme', 'suitcase')->execute();
  db_update('block')->fields(array('region' => '-1','status' => '0',))->condition('delta', 'navigation')->condition('theme', 'suitcase')->execute();
  db_update('block')->fields(array('region' => '-1','status' => '0',))->condition('delta', 'management')->condition('theme', 'suitcase')->execute();
  db_update('block')->fields(array('region' => '-1','status' => '0',))->condition('delta', 'login')->condition('theme', 'suitcase')->execute();
}

/**
 *  Implementation of function hook_form_FORM_ID_alter().
 * @param $form
 * @param $form_state
 */
function suitcase_config_form_system_site_information_settings_alter(&$form, &$form_state) {
  $form['site_information']['site_slogan']['#title'] = 'Department name';
  $form['site_information']['site_slogan']['#weight'] = '1';
  $form['site_information']['dept_url']= array(
    '#type' => 'textfield',
    '#title' => 'Department URL',
    '#default_value' => '',
    '#description' => 'Full url to the Department site',
    '#default_value' => variable_get('dept_url', $default = NULL),
    '#weight'=> '2',
  );
  $form['#submit'][]= 'suitcase_config_form_submit';
}

function suitcase_config_form_submit($form, &$form_state) {
  variable_set('dept_url', $form_state['values']['dept_url']);
}

/**
 * Implements hook_menu()
 */
function suitcase_config_menu() {
  $items = array();

  $items['admin/config/theme_settings'] = array(
    'title' => 'Theme',
    'description' => 'Settings related to formatting and configuring themes.',
    'position' => 'right',
    'weight' => -15,
    'page callback' => 'system_admin_menu_block_page',
    'access arguments' => array('administer site configuration'),
    'file' => 'system.admin.inc',
    'file path' => drupal_get_path('module', 'system'),
  );

  $items['admin/config/theme_settings/suitcase_config'] = array(
    'title' => 'Suitcase Settings',
    'description' => 'Custom css and logo configuration',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('_suitcase_config_form'),
    'access arguments' => array('administer site configuration'),
    'type' => MENU_NORMAL_ITEM
  );

  return $items;
}

function _suitcase_config_form($form, &$form_state) {
  $form['colors'] = array(
    '#type' => 'fieldset',
    '#title' => t('Colors'),
    '#collapsible' => TRUE,
    '#collapsed' => FALSE,
  );

  $form['colors']['suitcase_config_background_color'] = array(
    '#type' => 'textfield',
    '#title' => t('Background Color'),
    '#default_value' => variable_get('suitcase_config_background_color', '#f4f3e8'),
  );

  $form['colors']['suitcase_config_header_color'] = array(
    '#type' => 'textfield',
    '#title' => t('Header Color'),
    '#default_value' => variable_get('suitcase_config_header_color', '#CB1A2A'),
  );

  $form['colors']['suitcase_config_header_border_color'] = array(
    '#type' => 'textfield',
    '#title' => t('Header Border Color'),
    '#default_value' => variable_get('suitcase_config_header_border_color', '#DFBD00'),
  );

//  $form['colors']['suitcase_config_header_text_color'] = array(
//    '#type' => 'textfield',
//    '#title' => t('Header Text Color'),
//    '#default_value' => variable_get('suitcase_config_header_text_color', '#DFBD00'),
//  );

  $form['colors']['suitcase_config_footer_color'] = array(
    '#type' => 'textfield',
    '#title' => t('Footer Color'),
    '#default_value' => variable_get('suitcase_config_footer_color', '#CEC9BB'),
  );

  $form['#submit'][] = '_suitcase_config_form_submit';

  return system_settings_form($form);
}

function _suitcase_config_form_submit($form, &$form_state) {
//  $css = '.section-content{background-color:'.;
  $css = '';
  $css .= '.section-content{background-color:'.$form_state['values']['suitcase_config_background_color'].';}';
  $css .= '.section-header{background-color:'.$form_state['values']['suitcase_config_header_color'].';border-bottom:6px solid '.$form_state['values']['suitcase_config_header_border_color'].';}';
  $css .= '.body{background-color:'.$form_state['values']['suitcase_config_footer_color'].';}';
  file_save_data($css,'public://style.css',FILE_EXISTS_REPLACE);
}

function suitcase_config_preprocess_html(&$variables) {
  if($GLOBALS['theme'] == 'suitcase') {
    drupal_add_css('public://style.css',array('group'=>200));
  }
}